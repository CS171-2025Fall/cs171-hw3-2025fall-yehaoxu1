\documentclass[acmtog]{acmart}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{natbib}
\usepackage{listings}
\usepackage{bm}
\usepackage{amsmath}

\definecolor{blve}{rgb}{0.3372549 , 0.61176471, 0.83921569}
\definecolor{gr33n}{rgb}{0.29019608, 0.7372549, 0.64705882}
\makeatletter
\lst@InstallKeywords k{class}{classstyle}\slshape{classstyle}{}ld
\makeatother
\lstset{language=C++,
	basicstyle=\ttfamily,
	keywordstyle=\color{blve}\ttfamily,
	stringstyle=\color{red}\ttfamily,
	commentstyle=\color{magenta}\ttfamily,
	morecomment=[l][\color{magenta}]{\#},
	classstyle = \bfseries\color{gr33n}, 
	tabsize=2
}
\lstset{basicstyle=\ttfamily}

% Title portion
\title{Assignment 3:\\ {Basic Ray Tracing}} 

\author{Name: Ye Haoxu \\ student number: 2023533137 \\
email: \quad \texttt{}}

% Document starts
\begin{document}
\maketitle

\vspace*{2 ex}

\section{Introduction}

This report summarizes the implementation of a basic ray tracer for CS171 Assignment~3. The renderer supports BVH acceleration, analytic ray-triangle/AABB intersections, physically based BSDFs (Lambertian and perfect refraction), and both direct-lighting and random-walk style integration. Scenes are described by JSON configuration files and rendered to EXR images through the provided framework.

\section{Implementation Details}

\subsection{Acceleration and Intersections}

\begin{itemize}
	\item \textbf{BVH:} Implemented in \texttt{bvh\_tree.h} / \texttt{bvh\_accel.cpp}. Nodes are split by the median of centroids along the axis of maximum extent with a depth cap (20) and minimum leaf size (4 primitives).
	\item \textbf{Ray-Triangle:} \texttt{accel.cpp} uses the double-precision MÃ¶ller-Trumbore algorithm. Ray time bounds are respected so secondary hits remain consistent with differential rays.
	\item \textbf{Ray-AABB:} Implemented via the slab method with precomputed inverse directions for robustness.
\end{itemize}

\subsection{BSDFs and Integrators}

\begin{itemize}
	\item \textbf{Lambertian Diffuse:} Samples cosine-weighted directions and evaluates \(\rho / \pi\).
	\item \textbf{Perfect Refraction:} Applies Snell's law through \texttt{Refract} with total-internal-reflection fallback to \texttt{Reflect}. Entering/exiting media are detected from \(\mathbf{w}_o\cdot\mathbf{n}\).
	\item \textbf{IntersectionTestIntegrator:} Shoots rays until a diffuse hit is found, then performs point-light shading with a visibility test.
	\item \textbf{PathIntegrator:} Implements a classic path tracer with Russian roulette, throughput accumulation, BSDF sampling, and next-event estimation for emissive lights. Samples are averaged over \texttt{spp} per pixel.
\end{itemize}

\subsection{Rendering Pipeline}

Scenes in \texttt{data/} configure camera, materials, and integrator type. Rendering is parallelized with OpenMP. Output EXR files are tonemapped using \texttt{exrtools} for preview.

\section{Results}

\subsection{Tests}

The following tests pass after the final implementation:
\begin{itemize}
	\item Geometry/Math: \texttt{math\_tests}, \texttt{intersection\_tests}, \texttt{bvh\_tests}, \texttt{kdtree\_tests}.
	\item Texture/Property handling: \texttt{texture\_tests}, \texttt{factory\_tests}, \texttt{properties\_tests}.
	\item Distribution/SD-tree infrastructure: \texttt{distribution\_tests}, \texttt{sdtree\_tests}.
	\item Full pipeline: \texttt{integration\_tests} (all three scenes converge to the reference averages with \(1\times10^{-3}\) tolerance).
\end{itemize}

\subsection{Renderings}

Representative outputs (all available under \texttt{data/}):
\begin{itemize}
	\item \texttt{cbox\_no\_light.exr}: diffuse Cornell box lit by a point source, showing soft shadows.
	\item \texttt{cbox\_no\_light\_refract.exr}: demonstrates multi-bounce refraction through the glass sphere.
	\item \texttt{glass\_sphere.exr}: validates that the path integrator preserves caustics under multiple scattering.
\end{itemize}

All renders exhibit stable noise patterns that diminish with increased \texttt{spp}. The light flux in the Cornell scenes was tuned to \([8.5, 6.0, 2.5]\) to match reference exposure.

\section{Conclusion}

The project delivers a fully functional HW3 renderer with both direct-lighting and path-tracing integrators, verified through the provided automated tests and sample images.

\end{document}

